@using System.Globalization
@using Microsoft.AspNetCore.Http
@using AmwajGrocery.Models
@inject IHttpContextAccessor HttpContextAccessor
@model IEnumerable<Product>

@{
    var isAr = CultureInfo.CurrentUICulture.Name.StartsWith("ar");

    ViewData["isAr"] = isAr;

    var titleAr = ViewBag.CategoryNameAr as string ?? "المنتجات";
    var titleEn = ViewBag.CategoryNameEn as string ?? "Products";
    ViewData["Title"] = isAr ? titleAr : titleEn;

    var allCategories = ViewBag.Categories as List<Category>;
    int? currentCatId = ViewBag.CurrentCategoryId as int?;
}

<div class="container" style="padding-top: 20px;">

    <div class="page-section">
        <h1 style="text-align: center; color: var(--amwaj-primary); margin-bottom: 20px;">
            @(isAr? titleAr : titleEn)
        </h1>

        <div class="filter-container">
            <a href="/Home/Products" class="filter-btn @(currentCatId == null ? "active" : "")">
                @(isAr ? "الكل" : "All")
            </a>

            @if (allCategories != null)
            {
                foreach (var cat in allCategories)
                {
                    var catName = isAr ? cat.NameAr : (string.IsNullOrEmpty(cat.NameEn) ? cat.NameAr : cat.NameEn);

                    <a href="/Home/Products?categoryId=@cat.Id" class="filter-btn @(currentCatId == cat.Id ? "active" : "")">
                        @catName
                    </a>
                }
            }
        </div>

        @if (!string.IsNullOrEmpty(ViewBag.SearchQuery))
        {
            <p style="text-align: center; color: #777;">
                @(isAr ? "نتائج البحث عن:" : "Search results for:") "@ViewBag.SearchQuery"
            </p>
        }

        <p style="text-align: center; color: #777; margin-bottom: 30px;">
            @(isAr ? "يوجد حالياً" : "Currently showing")
            <span style="font-weight:bold; color:var(--amwaj-secondary);">@Model.Count()</span>
            @(isAr ? "منتج" : "products")
        </p>

        @if (!Model.Any())
        {
            <div style="text-align: center; padding: 50px;">
                <i class="fas fa-box-open fa-3x" style="color: #ccc; margin-bottom: 15px;"></i>
                <h3>@(isAr ? "لا توجد منتجات متاحة حالياً." : "No products available.")</h3>
                <a href="/" class="add-to-cart-btn" style="display: inline-block; width: auto; text-decoration: none;">
                    @(isAr ? "العودة للرئيسية" : "Back to Home")
                </a>
            </div>
        }
        else
        {
            <div class="product-grid">
                @foreach (var item in Model)
                {
                    <partial name="_ProductCard" model="item" view-data="ViewData" />
                }
            </div>
        }
    </div>
</div>